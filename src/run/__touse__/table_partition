CREATE TABLE proj_meta (
	proj_id				int NOT NULL PRIMARY KEY,
	path_on_host		string NOT NULL,
	source_url			string NOT NULL,
	source_branch		string NOT NULL,
	source_vcs_type		string NOT NULL,
	need_pull			bool NOT NULL
);

CREATE TABLE dp_log (
	log_date			date DEFAULT current_date,  /* 布署日期 */
	proj_id				int NOT NULL,  /* 项目 ID */
	rev_sig				string NOT NULL,  /* 布署的目标版本号 */
	cache_id			bigint NOT NULL,  /* 用作目标机状态确认的标识之一 */
	time_stamp			bigint NOT NULL,  /* 开始布署的时间(UNIX 时间戳) */
	time_limit			smallint NOT NULL DEFAULT 0,  /* 布署超时限制(单位：秒) */
	glob_res			smallint NOT NULL DEFAULT -1,  /* 全局整体布署结果 */
	host_ip				string NOT NULL,  /* 单台目标机 ip 地址 */
	host_res			smallint NOT NULL DEFAULT -1,  /* 单台目标机的布署结果 */
	host_timespent		smallint NOT NULL DEFAULT 0,  /* 单台目标机的实际布署耗时 */
	host_errno			int NOT NULL DEFAULT 0,  /* 单台目标机布署结果的最终状态码，若为 0，则 host_detail 字段为空 */
	host_detail			string
) PARTITION BY LIST (proj_id);

CREATE TABLE dp_log_<proj_id> (
	log_date			date DEFAULT current_date,
	proj_id				int NOT NULL,
	rev_sig				string NOT NULL,
	time_stamp			bigint NOT NULL,
	time_limit			smallint NOT NULL,
	glob_res			smallint NOT NULL,
	host_ip				string NOT NULL,
	host_res			smallint NOT NULL,
	host_timespent		smallint NOT NULL,
	host_errno			int NOT NULL,
	host_detail			string
) PARTITION OF dp_log FOR VALUES IN (<proj_id>) PARTITION BY RANGE (log_date);

# 新建项目时，一次性创建 1 年共计 12 张表格；另，开发接口，用于每年生成整年的表
CREATE TABLE dp_log_<proj_id>_201701 (
	log_date			date DEFAULT current_date,
	proj_id				int NOT NULL,
	rev_sig				string NOT NULL,
	time_stamp			bigint NOT NULL,
	time_limit			smallint NOT NULL,
	glob_res			smallint NOT NULL,
	host_ip				string NOT NULL,
	host_res			smallint NOT NULL,
	host_timespent		smallint NOT NULL,
	host_errno			int NOT NULL,
	host_detail			string
) partition of dp_log_<proj_id> for values from (MINVALUE) to ('2017-02-01');
